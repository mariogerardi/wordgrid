/* ==================================================================
   Wordgrid UI Stylesheet
   ------------------------------------------------------------------
   Table of Contents
   1. Layer order declaration
   2. Reset
   3. Design tokens
   4. Base styles
   5. Layout
   6. Components
      6.1 Editor & forms
      6.2 Board & cells
      6.3 Tiles & slots
      6.4 Controls & buttons
      6.5 Messaging & feedback
      6.6 Menus & cards
      6.7 Puzzle list
      6.8 How-to & level meta
      6.9 Game toolbar
   7. Utilities
   8. Overrides
================================================================== */

@layer reset, tokens, base, layout, components, utilities, overrides;

/* ============================== Reset ============================== */
@layer reset {
  * {
    box-sizing: border-box;
  }
}

/* ============================= Tokens ============================== */
@layer tokens {
  :root {
    color-scheme: light;
    /* Layout & spacing */
    --size-content-max: 840px;
    --content-max: var(--size-content-max); /* legacy alias */
    --cell: 56px; /* primary grid cell size */
    --cell-max: 75px; /* clamp cap shared by board/tiles */
    --cell-size-effective: min(var(--cell), var(--cell-max));
    --gap: 8px; /* grid gap managed via layout.js */
    --space-2xs: 2px;
    --space-xs: 4px;
    --space-sm: 6px;
    --space-md: 8px;
    --space-lg: 10px;
    --space-xl: 12px;
    --space-2xl: 14px;
    --space-3xl: 16px;
    --space-4xl: 20px;
    --space-5xl: 24px;
    --space-6xl: 32px;
    --space-7xl: 48px;
    --radius-sm: 6px;
    --radius-md: 8px;
    --radius-lg: 10px;
    --radius-xl: 12px;
    --radius-2xl: 14px;
    --radius-3xl: 16px;
    --radius-pill: 999px;

    /* Typography */
    --font-family-sans: 'Jost', ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    --font-size-base: 16px;
    --font-size-title: 22px;
    --font-size-title-sm: 20px;
    --font-size-h2: 15px;
    --font-size-cell-min: 12px;
    --font-size-cell-max: 18px;
    --font-size-cell-coord-min: 9px;
    --font-size-cell-coord-max: 11px;
    --font-weight-strong: 700;
    --font-weight-xstrong: 800;

    /* Color palette */
    --color-bg: #cce3ff;
    --color-surface: #ffffff;
    --color-surface-muted: #f1f3f5;
    --color-surface-alt: #f7f9ff;
    --color-surface-soft: #fbfcff;
    --color-surface-tint: #f2f4f7;
    --color-ink: #111827;
    --color-ink-strong: #1f2937;
    --color-ink-muted: #525a67;
    --color-ink-subtle: #66707a;
    --color-ink-soft: #6b7280;
    --color-ink-hint: #475569;
    --color-line: #d7dbe2;
    --color-line-strong: #cbd5e1;
    --color-line-subtle: #d7dee8;
    --color-line-soft: #dbe2f0;
    --color-line-muted: #e3e8ee;
    --color-accent: #2563ff;
    --color-accent-strong: #1b3fe0;
    --color-accent-contrast: #1f4dff;
    --color-accent-muted: #a9b8ff;
    --color-accent-soft: #eef3ff;
    --color-accent-disabled: #eef1ff;
    --color-accent-2: #f59e0b;
    --color-success: #10b981;
    --color-success-soft: #e9fff5;
    --color-success-border: #baf0de;
    --color-danger: #ee4444;
    --color-danger-soft: #fff2f2;
    --color-blocked: #111111;
    --color-slot-ink: #8a95a5;
    --color-info: #344055;
    --color-scroll-thumb: #cbd5e1;
    --color-pack-tag-border: #b7c6ff;
    --color-stripe-archetypes: #a855f7;
    --color-stripe-constraints: var(--color-success);
    --color-stripe-variety: var(--color-accent-2);
    --color-disabled-text: #a0a8b4;
    --color-disabled-border: #e7eaf0;
    --color-disabled-surface: #fbfcfe;
    --color-par-track-bg: rgba(255,255,255,.65);
    --color-par-track-border: #dbe2f0;
    --color-par-square: #e5e7eb;
    --color-par-square-border: #d1d5db;
    --color-par-square-best-border: #1d4ed8;
    --color-focus: var(--color-accent);
    --gradient-board: linear-gradient(180deg, #f8f9fb, #f5f6f8);

    /* Portal palette ramps (RGB for conic gradients) */
    --portal-rgb-default: 31, 77, 255;
    --portal-rgb-a: 139, 92, 246;
    --portal-rgb-b: 16, 185, 129;
    --portal-rgb-c: 245, 158, 11;
    --portal-rgb-d: 239, 68, 68;

    /* Elevation */
    --shadow-sm: 0 1px 1px rgba(16,24,40,.06);
    --shadow-md: 0 1px 2px rgba(16,24,40,.06), 0 1px 3px rgba(16,24,40,.1);
    --shadow-lg: 0 4px 12px rgba(16,24,40,.15);
    --shadow-hover-lg: 0 6px 18px rgba(16,24,40,.18);
    --shadow-accent: 0 2px 8px rgba(31,77,255,.28);
    --shadow-accent-strong: 0 3px 10px rgba(31,77,255,.34);
    --shadow-pill: 0 2px 6px rgba(16,24,40,.12);
    --shadow-inset: 0 0 0 2px rgba(37,99,255,.12) inset;
    --shadow: var(--shadow-md); /* legacy alias */

    /* Motion */
    --transition-fast: .12s ease;
    --transition-base: .15s ease;
    --transition-slow: .22s ease;
  }

  /* Theme hooks: override token values only */
  :root[data-theme="light"] {
    color-scheme: light;
  }

  :root[data-theme="dark"] {
    color-scheme: dark;
    --color-bg: #050b1a;
    --color-surface: #0f172a;
    --color-surface-muted: #16213b;
    --color-surface-alt: #18223a;
    --color-surface-soft: #101b30;
    --color-surface-tint: #1b2541;
    --color-ink: #e2e8f0;
    --color-ink-strong: #f8fafc;
    --color-ink-muted: #c3d0e8;
    --color-ink-subtle: #a0b3d4;
    --color-ink-soft: #94a3c4;
    --color-ink-hint: #7a8aac;
    --color-line: #1e293b;
    --color-line-strong: #24334a;
    --color-line-subtle: #1b2638;
    --color-line-soft: #1f2d45;
    --color-line-muted: #27364e;
    --color-accent: #60a5fa;
    --color-accent-strong: #3b82f6;
    --color-accent-contrast: #1d4ed8;
    --color-accent-muted: #1e3a8a;
    --color-accent-soft: #112447;
    --color-accent-disabled: #1a2640;
    --color-accent-2: #f59e0b;
    --color-success: #34d399;
    --color-success-soft: #103029;
    --color-success-border: #1f7054;
    --color-danger: #f87171;
    --color-danger-soft: #31141e;
    --color-blocked: #0b1220;
    --color-slot-ink: #94a3b8;
    --color-info: #c7d2fe;
    --color-scroll-thumb: #25344f;
    --color-pack-tag-border: #314266;
    --color-stripe-archetypes: #c084fc;
    --color-stripe-constraints: #34d399;
    --color-stripe-variety: #f59e0b;
    --color-disabled-text: #64748b;
    --color-disabled-border: #1e293b;
    --color-disabled-surface: #0b1526;
    --color-par-track-bg: rgba(15,23,42,.65);
    --color-par-track-border: #1e2b45;
    --color-par-square: #1f2937;
    --color-par-square-border: #334155;
    --color-par-square-best-border: #60a5fa;
    --color-focus: #93c5fd;
    --gradient-board: linear-gradient(180deg, #16233f, #0f1a2d);
    --shadow-sm: 0 1px 1px rgba(5,11,26,.6);
    --shadow-md: 0 1px 3px rgba(8,18,40,.55), 0 2px 6px rgba(8,18,40,.45);
    --shadow-lg: 0 8px 24px rgba(8,18,40,.55);
    --shadow-hover-lg: 0 12px 32px rgba(15,32,72,.55);
    --shadow-accent: 0 3px 12px rgba(96,165,250,.38);
    --shadow-accent-strong: 0 4px 18px rgba(96,165,250,.45);
    --shadow-pill: 0 2px 8px rgba(3,8,23,.6);
    --shadow-inset: 0 0 0 2px rgba(96,165,250,.32) inset;
  }

  :root[data-theme="contrast"] {
    color-scheme: dark;
    --color-bg: #000000;
    --color-surface: #0d0d0d;
    --color-surface-muted: #151515;
    --color-surface-alt: #1b1b1b;
    --color-surface-soft: #121212;
    --color-surface-tint: #1a1a1a;
    --color-ink: #ffffff;
    --color-ink-strong: #ffffff;
    --color-ink-muted: #e5e5e5;
    --color-ink-subtle: #d4d4d4;
    --color-ink-soft: #c4c4c4;
    --color-ink-hint: #bcbcbc;
    --color-line: #333333;
    --color-line-strong: #444444;
    --color-line-subtle: #262626;
    --color-line-soft: #1f1f1f;
    --color-line-muted: #2a2a2a;
    --color-accent: #00d7ff;
    --color-accent-strong: #00b4d8;
    --color-accent-contrast: #0096c7;
    --color-accent-muted: #014f86;
    --color-accent-soft: #012539;
    --color-accent-disabled: #023047;
    --color-accent-2: #ff3366;
    --color-success: #16f1a9;
    --color-success-soft: #012b1e;
    --color-success-border: #0ae7a0;
    --color-danger: #ff5572;
    --color-danger-soft: #33000a;
    --color-blocked: #ffffff;
    --color-slot-ink: #d6d6d6;
    --color-info: #9be8ff;
    --color-scroll-thumb: #3a3a3a;
    --color-pack-tag-border: #00d7ff;
    --color-stripe-archetypes: #f472b6;
    --color-stripe-constraints: #16f1a9;
    --color-stripe-variety: #ffcc00;
    --color-disabled-text: #b5b5b5;
    --color-disabled-border: #3a3a3a;
    --color-disabled-surface: #141414;
    --color-par-track-bg: rgba(255,255,255,.12);
    --color-par-track-border: #3a3a3a;
    --color-par-square: #1f1f1f;
    --color-par-square-border: #f5f5f5;
    --color-par-square-best-border: #00d7ff;
    --color-focus: #00f0ff;
    --gradient-board: linear-gradient(180deg, #1a1a1a, #000000);
    --shadow-sm: 0 0 0 1px #2e2e2e;
    --shadow-md: 0 0 0 1px #2e2e2e, 0 6px 12px rgba(0,0,0,.55);
    --shadow-lg: 0 12px 24px rgba(0,0,0,.7);
    --shadow-hover-lg: 0 18px 32px rgba(0,0,0,.75);
    --shadow-accent: 0 0 0 2px rgba(0,215,255,.35);
    --shadow-accent-strong: 0 0 0 2px rgba(0,215,255,.55);
    --shadow-pill: 0 0 0 1px #2e2e2e;
    --shadow-inset: 0 0 0 2px rgba(0,215,255,.45) inset;
  }

  @media (max-width: 600px) {
    :root {
      --cell: 48px;
      --gap: 6px;
      --font-size-title: var(--font-size-title-sm);
    }
  }
}

/* ============================= Base =============================== */
@layer base {
  html,
  body {
    height: 100%;
  }

  body {
    margin: 0;
    background: var(--color-bg);
    color: var(--color-ink);
    font-family: var(--font-family-sans);
    font-size: var(--font-size-base);
    line-height: 1.4;
  }

  h1 {
    margin: 0;
    font-size: var(--font-size-title);
    letter-spacing: .2px;
  }

  h2 {
    margin: var(--space-md) 0;
    font-size: var(--font-size-h2);
    color: var(--color-ink-muted);
    font-weight: var(--font-weight-strong);
  }

  button {
    padding: var(--space-lg) var(--space-2xl);
    border: 1px solid var(--color-line);
    background: var(--color-surface);
    border-radius: var(--radius-xl);
    font-weight: var(--font-weight-strong);
    letter-spacing: .2px;
    cursor: pointer;
    color: var(--color-ink);
    transition: background var(--transition-base), border-color var(--transition-base), transform var(--transition-fast);
  }

  button:hover {
    background: var(--color-surface-muted);
  }

  button:active {
    transform: translateY(1px);
  }

  button:disabled {
    color: var(--color-disabled-text);
    border-color: var(--color-disabled-border);
    background: var(--color-disabled-surface);
    cursor: not-allowed;
  }

  :focus-visible {
    outline: 2px solid var(--color-focus);
    outline-offset: 2px;
    border-radius: var(--radius-sm);
  }

  main hr {
    border: 0;
    border-top: 1px solid var(--color-line);
    margin: var(--space-xl) 0;
  }
}

/* ============================= Layout ============================= */
@layer layout {
  header {
    background: var(--color-surface);
    border-bottom: 1px solid var(--color-line);
    position: relative;
    z-index: 5; /* ensure header (hamburger) sits above overlay toolbar */
  }

  header .header-inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-xl);
    max-width: var(--size-content-max);
    margin: 0 auto;
    padding: var(--space-2xs) var(--space-xs);
  }

  header .header-actions {
    display: flex;
    gap: var(--space-lg);
    flex-wrap: nowrap;
    overflow: hidden;
    max-width: 0;
    transition: max-width .4s ease, gap .4s ease;
    justify-content: flex-end;
    padding-top: 2.5px;
  }

  header.header--open .header-actions {
    max-width: 600px;
    gap: var(--space-lg);
  }

  header .header-menu {
    border: 1px solid var(--color-line);
    background: var(--color-surface);
    border-radius: var(--radius-md);
    width: 34px;
    height: 34px;
    display: grid;
    place-items: center;
    cursor: pointer;
    transition: background var(--transition-base);
  }

  header .header-menu:hover {
    background: var(--color-surface-muted);
  }

  header .header-menu svg {
    width: 18px;
    height: 18px;
    color: var(--color-ink-muted);
  }

  header .header-actions .btn {
    padding: 6px 10px;
    font-size: 13px;
  }

  header .header-actions .btn--daily {
    background: var(--color-accent);
    border-color: var(--color-accent);
    color: #fff;
    box-shadow: 0 1px 2px rgba(37,99,255,.25);
  }

  header .header-actions .btn--daily:hover {
    background: var(--color-accent);
    border-color: var(--color-accent);
    color: #fff;
    filter: brightness(.97);
  }

  main.container {
    max-width: var(--size-content-max);
    margin: 20px auto;
    padding: 0 16px 24px;
    display: grid;
    grid-template-columns: minmax(0, 1fr);
    gap: 20px;
  }

  html:not(.app-ready) #app {
    opacity: 0;
  }

  #app {
    transition: opacity .18s ease;
  }

  .view {
    animation: viewFadeIn .5s ease both;
  }

  @keyframes viewFadeIn {
    from {
      opacity: 0;
      transform: translateY(4px);
    }

    to {
      opacity: 1;
      transform: none;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .view {
      animation: none;
    }
  }

  #boardMount {
    display: flex;
    flex-direction: column;
    align-items: stretch; /* children can choose their own width */
    gap: var(--space-xl);
    padding: var(--space-xl);
    background: transparent; /* transparent card */
    border: 0; /* no border */
    border-radius: var(--radius-3xl);
    box-shadow: none; /* no shadow */
  }

  #boardRoot {
    align-self: center;
  }

  :root .view #boardRoot {
    max-height: min(72vh, calc(100vh - 260px));
    overflow: auto;
  }

  #boardRoot::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  #boardRoot::-webkit-scrollbar-thumb {
    background: var(--color-scroll-thumb);
    border-radius: var(--radius-md);
  }

  .trays {
    display: grid;
    grid-template-columns: max-content max-content;
    justify-content: center; /* center the two columns as a block */
    align-items: start;
    column-gap: 24px;
    row-gap: var(--space-xl);
  }

  .trays--in-panel {
    position: sticky;
    bottom: calc(env(safe-area-inset-bottom) + 8px);
    padding: 0;
    backdrop-filter: none;
    background: transparent;
    border-radius: 0;
    box-shadow: none;
  }

  .tray--hand {
    grid-column: 1;
  }

  .tray--reserve {
    grid-column: 2;
  }

  .tray--controls {
    grid-column: 1; /* place with hand so left edges align */
    margin-top: var(--space-lg);
    display: flex;
    justify-content: flex-start;
  }

  .view .game-toolbar.game-toolbar--overlay {
    position: absolute;
    top: 8px;
    left: 0;
    right: 0;
    padding: 4px 10px;
    pointer-events: none;
    max-width: var(--size-content-max);
    margin: 0 auto;
  }

  .view .game-toolbar.game-toolbar--overlay > * {
    pointer-events: auto;
  }

  .is-daily .game-toolbar.game-toolbar--overlay > :first-child {
    display: none;
  }
}

/* ============================ Components ========================== */
@layer components {
  /* ----- Editor & forms ----- */
  .editor-grid {
    display: grid;
    grid-template-columns: 1fr 380px;
    gap: var(--space-3xl);
    align-items: start;
  }

  @media (max-width: 980px) {
    .editor-grid {
      grid-template-columns: 1fr;
    }
  }

  .editor-col {
    display: flex;
    flex-direction: column;
    gap: var(--space-3xl);
  }

  .editor-card {
    background: var(--color-surface);
    border: 1px solid var(--color-line);
    border-radius: var(--radius-2xl);
    box-shadow: var(--shadow);
    padding: var(--space-2xl);
  }

  .editor-card h3 {
    margin: 4px 0 10px;
  }

  .editor-toolbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-xl);
  }

  .tools {
    display: flex;
    gap: var(--space-lg);
    flex-wrap: wrap;
    margin: var(--space-lg) 0;
  }

  .field {
    display: flex;
    align-items: center;
    gap: var(--space-lg);
    margin: 6px 0;
  }

  .field label {
    min-width: 88px;
    font-weight: var(--font-weight-strong);
    color: var(--color-ink-muted);
  }

  .field input[type="text"],
  .field input[type="number"],
  .field textarea {
    flex: 1;
    padding: var(--space-md) var(--space-lg);
    border: 1px solid var(--color-line);
    border-radius: var(--radius-md);
    font-weight: var(--font-weight-strong);
  }

  /* ----- Board & cells ----- */
  #editorBoard.board {
    margin: auto;
  }

  .board {
    --cols: 7;
    --rows: 7;
    display: grid;
    grid-template-columns: repeat(var(--cols), var(--cell-size-effective));
    grid-template-rows: repeat(var(--rows), var(--cell-size-effective));
    gap: var(--gap);
    padding: var(--gap);
    background: var(--gradient-board);
    border: 1px solid var(--color-line);
    border-radius: var(--radius-2xl);
    position: relative;
    box-shadow: var(--shadow);
  }

  :root.cells-compact .board {
    gap: var(--gap);
  }

  .cell {
    width: var(--cell-size-effective);
    height: var(--cell-size-effective);
    display: grid;
    place-items: center;
    background: var(--color-surface);
    border: 1px solid var(--color-line);
    border-radius: var(--radius-lg);
    overflow: hidden; /* clip portal animation to cell */
    font-weight: var(--font-weight-xstrong);
    font-size: clamp(var(--font-size-cell-min), calc(var(--cell-size-effective) * 0.34), var(--font-size-cell-max));
    letter-spacing: .4px;
    padding: 2px 4px;
    text-align: center;
    line-height: 1.05;
    user-select: none;
    transition: border-color var(--transition-base), background var(--transition-base), transform .03s ease;
    position: relative; /* <-- needed so ★ anchors to the cell */
    box-shadow: var(--shadow-sm);
  }

  .cell:hover {
    transform: translateY(-1px);
  }

  .cell__text {
    position: relative;
    z-index: 1;
  }

  .cell__coord {
    position: absolute;
    right: 6px;
    bottom: 4px;
    font-size: clamp(var(--font-size-cell-coord-min), calc(var(--cell) * 0.18), var(--font-size-cell-coord-max));
    font-weight: var(--font-weight-xstrong);
    color: var(--color-ink-soft);
    letter-spacing: .2px;
    pointer-events: none;
    z-index: 2;
  }

  :root.cells-compact .cell__coord {
    display: none;
  }

  .cell--goal .cell__coord,
  .cell--projection .cell__coord {
    z-index: 3;
  }

  .cell--filled .cell__coord,
  .cell--seed .cell__coord {
    color: rgba(255,255,255,.75);
  }

  .cell--blocked .cell__coord {
    display: none;
  }

  .cell--goal::before {
    content: "★";
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    font-size: calc(var(--cell-size-effective) * 0.44);
    color: var(--color-accent-2);
    opacity: .7;
    pointer-events: none;
  }

  .cell--filled {
    background: var(--color-accent);
    border-color: var(--color-accent);
    color: #fff;
    box-shadow: var(--shadow-accent);
  }

  .cell--filled .cell__text {
    color: #fff;
  }

  .board--3 .cell {
    font-size: clamp(13px, calc(var(--cell) * 0.38), 22px);
  }

  .board--5 .cell {
    font-size: clamp(12px, calc(var(--cell) * 0.36), 20px);
  }

  .cell--portal {
    --portal-base: var(--portal-rgb-default);
  }

  .cell--portal-A {
    --portal-base: var(--portal-rgb-a);
  }

  .cell--portal-B {
    --portal-base: var(--portal-rgb-b);
  }

  .cell--portal-C {
    --portal-base: var(--portal-rgb-c);
  }

  .cell--portal-D {
    --portal-base: var(--portal-rgb-d);
  }

  .cell--portal::before {
    content: "";
    position: absolute;
    inset: 2px; /* fill cell, swirl inside */
    border-radius: inherit;
    background:
      radial-gradient(circle at 50% 50%, rgba(var(--portal-base), .20), rgba(var(--portal-base), 0) 60%),
      conic-gradient(from var(--portal-angle, 0deg), rgba(var(--portal-base), .35), rgba(var(--portal-base), 0) 25%, rgba(var(--portal-base), .35) 50%, rgba(var(--portal-base), 0) 75%, rgba(var(--portal-base), .35));
    filter: blur(.2px);
    opacity: .8;
    pointer-events: none;
    animation: portalSwirl 6s linear infinite;
  }

  @property --portal-angle {
    syntax: '<angle>';
    inherits: false;
    initial-value: 0deg;
  }

  @keyframes portalSwirl {
    to {
      --portal-angle: 360deg;
    }
  }

  .cell--projection {
    background: rgba(37,99,255,.10);
    border-color: var(--color-line-strong);
  }

  .cell--seed {
    background:
      linear-gradient(0deg, rgba(255,255,255,.05), rgba(255,255,255,.05)),
      var(--color-accent);
    border-color: var(--color-accent);
    color: #fff;
  }

  .cell--seed .cell__text {
    color: #fff;
  }

  .cell--seed::after {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    border-radius: inherit;
    background: repeating-linear-gradient(45deg, rgba(255,255,255,.12) 0 6px, transparent 6px 12px);
  }

  .cell--preview {
    border-style: dashed;
    opacity: .9;
  }

  .cell--conflict {
    border-color: var(--color-danger);
    background: var(--color-danger-soft);
  }

  .cell--selected {
    outline: 3px solid var(--color-accent);
    outline-offset: -3px;
    box-shadow: var(--shadow-inset), 0 0 0 3px rgba(37,99,255,.25), 0 4px 12px rgba(31,77,255,.18);
    transform: translateY(-1px);
    z-index: 2;
  }

  .cell--blocked {
    background: var(--color-blocked);
    border-color: var(--color-blocked);
    position: relative;
  }

  .cell--blocked::before {
    /* subtle hatch to differentiate from "just empty" */
    content: "";
    position: absolute;
    inset: 0;
    background:
      linear-gradient(45deg, rgba(255,255,255,.06) 25%, transparent 25%) 0 0 / 8px 8px,
      linear-gradient(-45deg, rgba(255,255,255,.06) 25%, transparent 25%) 0 0 / 8px 8px;
    border-radius: inherit;
  }

  .cell--blocked:hover {
    transform: none;
  }

  /* ----- Tiles & slots ----- */
  .tiles {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-lg);
    min-height: 48px;
  }

  .tile {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: max(33px, fit-content);
    max-width: 100px;
    padding: 14px 12px;
    background: var(--color-accent);
    border: 1px solid var(--color-accent);
    color: #fff;
    border-radius: var(--radius-xl);
    font-weight: var(--font-weight-xstrong);
    letter-spacing: .5px;
    cursor: grab;
    user-select: none;
    box-shadow: var(--shadow-accent);
    transition: transform .05s ease, filter var(--transition-base), background var(--transition-base), box-shadow var(--transition-base);
  }

  .tile:active {
    cursor: grabbing;
    transform: translateY(1px);
  }

  .tile--dragging {
    opacity: 0;
  }

  .tile--drag-ghost {
    position: fixed;
    top: -9999px;
    left: -9999px;
    width: var(--cell-size-effective);
    height: var(--cell-size-effective);
    display: grid;
    place-items: center;
    border-radius: var(--radius-md);
    font-size: clamp(var(--font-size-cell-min), calc(var(--cell-size-effective) * 0.34), var(--font-size-cell-max));
    pointer-events: none;
  }

  .tile--selected {
    filter: brightness(.96);
    box-shadow: var(--shadow-accent-strong);
  }

  .tile--ghost {
    opacity: .6;
    border-style: dashed;
    cursor: pointer;
  }

  .tile--ghost:hover {
    opacity: .85;
  }

  .tile--locked {
    opacity: .55;
    cursor: not-allowed;
  }

  .tile--ghost::after {
    content: "↩";
    position: absolute;
    top: -6px;
    right: -6px;
    font-size: 11px;
    line-height: 1;
    padding: 2px 4px;
    border-radius: var(--radius-md);
    background: var(--color-surface);
    border: 1px solid var(--color-line);
    color: var(--color-ink-muted);
  }

  #handMount .tiles--with-slots,
  #reserveMount .tiles--with-slots {
    display: flex !important;
    gap: var(--space-xl);
    flex-wrap: nowrap;
  }

  .slot {
    display: flex;
    align-items: center;
    justify-content: center;
    width: var(--cell-size-effective);
    height: var(--cell-size-effective);
    min-height: var(--cell-size-effective);
    flex: 0 0 var(--cell-size-effective);
    border: 1px dashed var(--color-line);
    border-radius: var(--radius-xl);
    background: var(--color-surface);
    color: var(--color-ink-muted);
    box-shadow: var(--shadow);
    transition: background var(--transition-base), border-color var(--transition-base), color var(--transition-base);
  }

  .slot--empty {
    display: grid;
    place-items: center;
    font-weight: var(--font-weight-strong);
    letter-spacing: .5px;
    background: var(--color-surface-muted);
    border-color: var(--color-line-subtle);
    color: var(--color-slot-ink);
    font-size: clamp(var(--font-size-cell-min), calc(var(--cell) * 0.34), var(--font-size-cell-max));
  }

  .slot--empty:hover {
    border-color: var(--color-accent);
    color: var(--color-accent);
    background: var(--color-surface-tint);
    cursor: pointer;
  }

  .tiles--with-slots .tile {
    width: 100%;
    height: 100%;
    display: grid;
    place-items: center;
    border-radius: var(--radius-md);
    font-size: clamp(var(--font-size-cell-min), calc(var(--cell-size-effective) * 0.34), var(--font-size-cell-max));
    position: relative;
  }

  .tiles--with-slots .tile.tile--selected {
    outline: 3px solid var(--color-accent);
    outline-offset: 2px;
    box-shadow: 0 0 0 3px rgba(37,99,255,.25), 0 4px 12px rgba(31,77,255,.28);
  }

  /* ----- Controls & buttons ----- */
  .controls {
    display: flex;
    gap: var(--space-lg);
    flex-wrap: wrap;
  }

  .btn {
    display: inline-block;
    padding: var(--space-lg) var(--space-2xl);
    border: 1px solid var(--color-line);
    border-radius: var(--radius-xl);
    background: var(--color-surface);
    color: var(--color-ink);
    text-decoration: none;
    font-weight: var(--font-weight-strong);
    transition: background var(--transition-base), border-color var(--transition-base), transform var(--transition-fast);
  }

  .btn:not(.btn--primary):hover {
    background: var(--color-surface-muted);
    transform: translateY(-1px);
  }

  .btn--primary {
    background: var(--color-accent);
    border-color: var(--color-accent);
    color: #fff;
    box-shadow: 0 2px 6px rgba(31,77,255,.28);
  }

  .btn--primary:hover {
    filter: brightness(.96);
  }

  #btnPlay {
    background: var(--color-accent);
    border-color: var(--color-accent);
    color: #fff;
    box-shadow: 0 1px 2px rgba(37,99,255,.25);
  }

  #btnPlay:hover {
    filter: brightness(.97);
  }

  #btnPlay:disabled {
    background: var(--color-accent-muted);
    border-color: var(--color-accent-muted);
    color: var(--color-accent-disabled);
  }

  @media (max-width: 560px) {
    .btn {
      width: 100%;
      text-align: center;
    }
  }

  /* ----- Messaging & feedback ----- */
  #messages {
    font-size: 14px;
    color: var(--color-info);
    margin-top: 4px;
  }

  #boardMount .game-messages {
    text-align: center;
    color: var(--color-ink-strong);
    margin-left: auto;
    margin-right: auto;
  }

  #toastRoot {
    position: fixed;
    left: 50%;
    transform: translateX(-50%);
    bottom: 22px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
    align-items: center;
    pointer-events: none;
  }

  .toast {
    pointer-events: auto;
    background: var(--color-surface);
    color: var(--color-ink);
    border: 1px solid var(--color-line);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow);
    padding: var(--space-lg) var(--space-2xl);
    font-weight: var(--font-weight-xstrong);
    letter-spacing: .2px;
    opacity: 0;
    transform: translateY(8px) scale(.98);
    transition: opacity var(--transition-slow), transform var(--transition-slow);
  }

  .toast--in {
    opacity: 1;
    transform: translateY(0) scale(1);
  }

  .toast--out {
    opacity: 0;
    transform: translateY(8px) scale(.98);
  }

  /* ----- Menus & cards ----- */
  .section--centered {
    text-align: center;
    padding: 48px 20px;
  }

  .home-title {
    margin: 0 0 10px;
    font-size: 48px;
    letter-spacing: .3px;
  }

  .home-tagline {
    color: var(--color-ink-muted);
    margin: 0 0 22px;
    font-size: 18px;
  }

  .home-actions {
    display: none;
  }

  .menu-grid {
    --tileMin: 160px;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(var(--tileMin), 1fr));
    gap: var(--space-3xl);
    max-width: 920px;
    margin: 0 auto;
  }

  .menu-tile {
    display: grid;
    place-items: center;
    aspect-ratio: 1 / 1; /* square, scales automatically */
    background: var(--color-surface);
    border: 1px solid var(--color-line);
    border-radius: var(--radius-2xl); /* nod to board cells */
    box-shadow: var(--shadow);
    color: var(--color-ink);
    text-decoration: none;
    font-weight: var(--font-weight-xstrong);
    letter-spacing: .3px;
    transition: transform var(--transition-slow), background var(--transition-base), border-color var(--transition-base), box-shadow var(--transition-base);
    position: relative;
    overflow: hidden;
    will-change: transform;
  }

  .menu-tile::before {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    background:
      repeating-linear-gradient(0deg, transparent 0, transparent calc(33.33% - 1px), rgba(31,77,255,.06) calc(33.33% - 1px), rgba(31,77,255,.06) 33.33%),
      repeating-linear-gradient(90deg, transparent 0, transparent calc(33.33% - 1px), rgba(31,77,255,.06) calc(33.33% - 1px), rgba(31,77,255,.06) 33.33%);
  }

  .menu-tile:hover {
    background: var(--color-surface-alt);
    border-color: var(--color-line-strong);
    box-shadow: var(--shadow-hover-lg);
    transform: translateY(-6px);
    transition-delay: 0s; /* instant lift */
    animation: tileWobble 520ms ease-out;
  }

  .menu-tile:not(:hover) {
    transition-delay: .08s;
  }

  .menu-tile__label {
    font-size: 18px;
    text-align: center;
    padding: 0 10px;
  }

  .menu-tile--primary {
    background: var(--color-accent);
    border-color: var(--color-accent);
    color: #fff;
    box-shadow: var(--shadow-accent);
  }

  .menu-tile--primary .menu-tile__label {
    color: inherit;
    text-shadow: none;
  }

  .menu-tile--primary::before {
    background:
      repeating-linear-gradient(0deg, transparent 0, transparent calc(33.33% - 1px), rgba(255,255,255,.10) calc(33.33% - 1px), rgba(255,255,255,.10) 33.33%),
      repeating-linear-gradient(90deg, transparent 0, transparent calc(33.33% - 1px), rgba(255,255,255,.10) calc(33.33% - 1px), rgba(255,255,255,.10) 33.33%);
  }

  .menu-tile--primary:hover {
    background:
      linear-gradient(0deg, rgba(0,0,0,.05), rgba(0,0,0,.05)),
      var(--color-accent);
    border-color: var(--color-accent-strong);
    box-shadow: 0 8px 20px rgba(31,77,255,.34), 0 0 0 2px rgba(255,255,255,.22) inset;
  }

  .menu-tile--primary:hover .menu-tile__label {
    color: inherit;
    text-shadow: none;
  }

  .menu-tile--primary:hover::before {
    background:
      repeating-linear-gradient(0deg, transparent 0, transparent calc(33.33% - 1px), rgba(255,255,255,.12) calc(33.33% - 1px), rgba(255,255,255,.12) 33.33%),
      repeating-linear-gradient(90deg, transparent 0, transparent calc(33.33% - 1px), rgba(255,255,255,.12) calc(33.33% - 1px), rgba(255,255,255,.12) 33.33%);
  }

  @keyframes tileWobble {
    0% {
      transform: translateY(-6px) rotate(0deg) scale(1);
    }

    25% {
      transform: translateY(-8px) rotate(-1.8deg) scale(1.008);
    }

    50% {
      transform: translateY(-7px) rotate(1.2deg) scale(1.006);
    }

    75% {
      transform: translateY(-8px) rotate(-0.8deg) scale(1.004);
    }

    100% {
      transform: translateY(-6px) rotate(0deg) scale(1);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .menu-tile:hover {
      transform: translateY(-4px);
    }
  }

  @media (max-width: 560px) {
    .menu-grid {
      --tileMin: 130px;
      gap: var(--space-xl);
    }

    .menu-tile__label {
      font-size: 16px;
    }
  }

  .packs-section {
    padding: var(--space-2xl) 0 18px;
    border-top: 1px solid var(--color-line);
    margin-top: 10px;
  }

  .packs-section:first-of-type {
    border-top: 0;
    margin-top: 0;
    padding-top: 0;
  }

  .packs-section__title {
    margin: 0 0 8px;
    font-size: 22px;
    font-weight: 900;
    letter-spacing: .3px;
    position: relative;
  }

  .packs-section__title::after {
    content: "";
    display: block;
    width: 64px;
    height: 3px;
    margin-top: 6px;
    background: var(--color-accent);
    border-radius: 3px;
  }

  .packs-section__desc {
    margin: 6px 0 14px;
    color: var(--color-ink-muted);
    font-size: 15px;
  }

  .pack-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--space-lg);
  }

  .pack-card {
    text-decoration: none;
  }

  .pack-card--series {
    position: relative;
    display: grid;
    grid-template-columns: 1fr auto;
    align-items: center;
    gap: var(--space-md);
    padding: 10px 12px 10px 22px; /* extra left padding so stripe doesn't overlap text */
    border: 1px solid var(--color-line);
    border-radius: var(--radius-lg);
    background: linear-gradient(180deg, var(--color-surface), var(--color-surface-soft));
    color: var(--color-ink);
    box-shadow: var(--shadow);
    transition: transform var(--transition-base), border-color var(--transition-base), box-shadow var(--transition-base);
    will-change: transform, box-shadow, border-color;
    backface-visibility: hidden;
    transform: translateZ(0);
  }

  .pack-card--series::before {
    content: "";
    position: absolute;
    left: 6px;
    top: 6px;
    bottom: 6px;
    width: 6px;
    border-radius: var(--radius-sm);
    background: var(--series-stripe, var(--color-accent-contrast));
    pointer-events: none;
  }

  .pack-card--series:hover {
    transform: translateY(-1px);
    border-color: var(--color-line-strong);
    box-shadow: var(--shadow-lg);
  }

  .pack-card--locked {
    opacity: .6;
    pointer-events: none;
  }

  .pack-card--curriculum {
    --series-stripe: var(--color-accent);
  }

  .pack-card--archetypes {
    --series-stripe: var(--color-stripe-archetypes);
  }

  .pack-card--constraints {
    --series-stripe: var(--color-stripe-constraints);
  }

  .pack-card--variety {
    --series-stripe: var(--color-stripe-variety);
  }

  .pack-card__body {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .pack-card__title {
    font-weight: 900;
    font-size: 15px;
  }

  .pack-card__desc {
    color: var(--color-ink-muted);
    font-size: 12px;
    line-height: 1.35;
  }

  .pack-card__tag {
    align-self: start;
    margin-top: 4px;
    font-size: 10px;
    padding: 2px 7px;
    border-radius: var(--radius-pill);
    background: var(--color-accent-soft);
    color: var(--color-accent-contrast);
    border: 1px solid var(--color-pack-tag-border);
  }

  .pack-card--locked .pack-card__tag {
    background: var(--color-surface-tint);
    color: var(--color-ink-subtle);
    border-color: var(--color-line-muted);
  }

  .pack-card__status {
    position: absolute;
    right: 8px;
    top: 6px;
    width: 18px;
    height: 18px;
    color: var(--color-ink-soft);
  }

  .pack-card__status svg {
    display: block;
    width: 100%;
    height: 100%;
  }

  /* ----- Theme cards ----- */
  .theme-view .theme-current {
    margin: var(--space-3xl) 0;
    font-size: 15px;
    color: var(--color-ink-muted);
  }

  .theme-current__name {
    color: var(--color-accent-strong);
  }

  .theme-grid {
    display: grid;
    gap: var(--space-4xl);
    margin-top: var(--space-4xl);
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  }

  .theme-card {
    position: relative;
    display: flex;
    flex-direction: column;
    gap: var(--space-3xl);
    padding: var(--space-5xl);
    border-radius: var(--radius-3xl);
    background: linear-gradient(180deg, var(--color-surface), var(--color-surface-soft));
    border: 1px solid var(--color-line);
    box-shadow: var(--shadow-sm);
    transition: transform var(--transition-fast), box-shadow var(--transition-base), border-color var(--transition-base);
    min-height: 100%;
    --theme-preview: linear-gradient(135deg, rgba(255,255,255,.85), rgba(255,255,255,.42));
    --theme-preview-text: var(--color-ink);
  }

  .theme-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-hover-lg);
    border-color: var(--color-line-strong);
  }

  .theme-card--active {
    border-color: var(--color-accent);
    box-shadow: var(--shadow-accent);
  }

  .theme-card--locked {
    opacity: .92;
  }

  .theme-card--locked:hover {
    transform: none;
    box-shadow: var(--shadow-sm);
  }

  .theme-card--locked .theme-card__badge--locked {
    background: var(--color-line-soft);
  }

  .theme-card__preview {
    position: relative;
    height: 140px;
    border-radius: var(--radius-2xl);
    overflow: hidden;
    background: var(--theme-preview);
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.28);
  }

  .theme-card__preview-grid {
    position: relative;
    width: 100%;
    height: 100%;
    border-radius: inherit;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--theme-preview-text);
    font-size: 26px;
    font-weight: var(--font-weight-xstrong);
    letter-spacing: .6px;
    text-transform: uppercase;
  }

  .theme-card__preview-grid::before {
    content: '';
    position: absolute;
    inset: var(--space-4xl);
    border-radius: var(--radius-xl);
    background:
      repeating-linear-gradient(0deg, transparent 0, transparent calc(33.333% - 2px), rgba(255,255,255,.35) calc(33.333% - 2px), rgba(255,255,255,.35) calc(33.333%)),
      repeating-linear-gradient(90deg, transparent 0, transparent calc(33.333% - 2px), rgba(255,255,255,.35) calc(33.333% - 2px), rgba(255,255,255,.35) calc(33.333%));
    box-shadow: 0 0 0 1px rgba(255,255,255,.4);
    opacity: .65;
  }

  .theme-card__preview-text {
    position: relative;
    z-index: 1;
    text-shadow: 0 4px 16px rgba(0,0,0,.25);
  }

  .theme-card__body {
    display: flex;
    flex-direction: column;
    gap: var(--space-xl);
    flex: 1;
  }

  .theme-card__header {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    gap: var(--space-lg);
  }

  .theme-card__name {
    margin: 0;
    font-size: 18px;
    color: var(--color-ink);
  }

  .theme-card__badge {
    display: inline-flex;
    align-items: center;
    padding: 4px 12px;
    border-radius: var(--radius-pill);
    font-size: 12px;
    font-weight: var(--font-weight-strong);
    background: var(--color-surface-muted);
    color: var(--color-ink-soft);
    text-transform: uppercase;
    letter-spacing: .4px;
  }

  .theme-card__badge--active {
    background: var(--color-accent);
    color: #fff;
    box-shadow: var(--shadow-accent);
  }

  .theme-card__badge--locked {
    background: var(--color-line-soft);
    color: var(--color-ink-soft);
  }

  .theme-card__desc {
    margin: 0;
    color: var(--color-ink-muted);
    line-height: 1.5;
    font-size: 14px;
  }

  .theme-card__unlock {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
    color: var(--color-ink-soft);
    font-size: 13px;
  }

  .theme-card__tag {
    align-self: flex-start;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 11px;
    font-weight: var(--font-weight-strong);
    text-transform: uppercase;
    letter-spacing: .45px;
    padding: 4px 12px;
    border-radius: var(--radius-pill);
    background: var(--color-surface-muted);
    color: var(--color-ink-soft);
  }

  .theme-card__unlock-text {
    line-height: 1.45;
  }

  .theme-card__footer {
    margin-top: auto;
  }

  .theme-card__footer .btn {
    width: 100%;
    text-align: center;
  }

  .theme-card__footer .btn[disabled] {
    cursor: not-allowed;
    opacity: .85;
  }

  .theme-card--placeholder .theme-card__tag {
    background: var(--color-surface-tint);
  }

  @media (max-width: 720px) {
    .theme-grid {
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: var(--space-3xl);
    }
  }

  @media (max-width: 560px) {
    .theme-card {
      padding: var(--space-4xl);
    }

    .theme-card__preview {
      height: 120px;
    }
  }

  /* ----- Puzzle list ----- */
  .puzzles-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: var(--space-lg);
  }

  .puzzle-tile {
    display: block;
    padding: var(--space-xl);
    border: 1px solid var(--color-line);
    border-radius: var(--radius-xl);
    background: var(--color-surface);
    color: var(--color-ink);
    text-decoration: none;
    box-shadow: var(--shadow);
    transition: transform var(--transition-fast), border-color var(--transition-base), background var(--transition-base);
    position: relative;
  }

  .puzzle-tile:hover {
    transform: translateY(-1px);
    background: var(--color-surface-alt);
    border-color: var(--color-line-strong);
  }

  .puzzle-tile--locked {
    pointer-events: none;
    opacity: .55;
  }

  .puzzle-tile__num {
    font-weight: var(--font-weight-xstrong);
    margin-bottom: 4px;
  }

  .puzzle-tile__row {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: var(--space-lg);
  }

  .puzzle-tile__name {
    color: var(--color-ink-muted);
    font-size: 14px;
  }

  .puzzle-tile__par {
    color: var(--color-ink-muted);
    font-size: 12px;
  }

  .puzzle-tile__right {
    display: flex;
    flex-direction: column;
    gap: 2px;
    align-items: flex-end;
    text-align: right;
  }

  .puzzle-tile__status {
    margin-top: 8px;
    font-size: 12px;
    color: var(--color-accent);
  }

  .puzzle-tile--locked .puzzle-tile__status {
    color: var(--color-ink-subtle);
  }

  .puzzle-tile__best {
    margin-top: 0;
    font-size: 12px;
    color: var(--color-ink-hint);
  }

  .puzzle-tile__check {
    position: absolute;
    right: 8px;
    top: 8px;
    width: 18px;
    height: 18px;
    display: grid;
    place-items: center;
    background: var(--color-success-soft);
    color: var(--color-success);
    border: 1px solid var(--color-success-border);
    border-radius: 50%;
    font-weight: var(--font-weight-strong);
    font-size: 12px;
  }

  .puzzles-grid[data-pack="tutorial"] .puzzle-tile__name {
    font-style: italic;
  }

  /* ----- How-to & level meta ----- */
  .lead {
    font-size: 16px;
    margin-bottom: var(--space-3xl);
    color: var(--color-ink-muted);
  }

  .howto-list {
    padding-left: 20px;
    margin: 0;
  }

  .howto-list li {
    margin-bottom: 10px;
    line-height: 1.45;
  }

  .board--mini {
    border-radius: var(--radius-lg);
  }

  .howto-example {
    margin: 10px 0 14px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-sm);
  }

  .howto-examples-flex {
    display: flex;
    gap: var(--space-3xl);
    flex-wrap: wrap;
    align-items: flex-start;
  }

  .howto-caption {
    font-size: 12px;
    color: var(--color-ink-subtle);
    text-align: center;
    max-width: 320px;
  }

  .howto-block {
    margin: 14px 0 18px;
  }

  .level-meta {
    margin: 8px 0 6px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--space-xl);
    text-align: center;
  }

  .level-meta__title {
    font-weight: 900;
    font-size: 28px;
    letter-spacing: .2px;
    margin-bottom: 8px;
    position: relative;
  }

  .level-meta__title::after {
    content: "";
    display: block;
    width: 72px;
    height: 3px;
    margin: 6px auto 0;
    background: var(--color-accent);
    border-radius: 3px;
  }

  .level-meta__stats {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-lg);
  }

  .par-meter {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-lg);
  }

  .par-meter__track {
    display: flex;
    align-items: center;
    gap: var(--space-lg);
    padding: var(--space-lg) var(--space-xl);
    border-radius: var(--radius-pill);
    background: var(--color-par-track-bg);
    border: 1px solid var(--color-par-track-border);
    box-shadow: inset 0 1px 2px rgba(16,24,40,.06);
  }

  .par-meter__label {
    display: none;
  }

  .level-intro {
    color: var(--color-ink-soft);
    font-size: 13px;
    margin-bottom: 4px;
    line-height: 1.25;
    max-width: 720px;
  }

  .par-square {
    display: inline-block;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: var(--color-par-square);
    border: 1px solid var(--color-par-square-border);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.6);
  }

  .par-square--anim {
    animation: parFill .35s ease forwards, parPop .35s ease;
    animation-delay: calc(var(--i) * 60ms);
  }

  .par-square--best {
    background: var(--color-accent);
    border-color: var(--color-par-square-best-border);
    box-shadow: 0 0 0 0 rgba(31,77,255,.35), inset 0 1px 0 rgba(255,255,255,.6);
    animation: parPulse 1.6s ease-out 0s 5;
  }

  @keyframes parPulse {
    0% {
      box-shadow: 0 0 0 0 rgba(31,77,255,.35), inset 0 1px 0 rgba(255,255,255,.6);
    }

    70% {
      box-shadow: 0 0 0 5px rgba(31,77,255,0), inset 0 1px 0 rgba(255,255,255,.6);
    }

    100% {
      box-shadow: 0 0 0 0 rgba(31,77,255,0), inset 0 1px 0 rgba(255,255,255,.6);
    }
  }

  @keyframes parFill {
    from {
      background: var(--color-par-square);
      border-color: var(--color-par-square-border);
    }

    to {
      background: var(--color-accent);
      border-color: var(--color-par-square-best-border);
    }
  }

  @keyframes parPop {
    from {
      transform: scale(.92);
    }

    to {
      transform: scale(1);
    }
  }

  .best-badge {
    position: absolute;
    right: -16px;
    top: -14px;
    z-index: 1;
    font-size: 11px;
    padding: 2px 6px;
    border-radius: var(--radius-pill);
    background: var(--color-accent-soft);
    color: var(--color-accent-contrast);
    border: 1px solid var(--color-pack-tag-border);
    box-shadow: var(--shadow-pill);
    pointer-events: none;
  }

  /* ----- Game toolbar ----- */
  .game-toolbar {
    position: relative;
    z-index: 2;
  }
}

/* ============================= Utilities ========================== */
@layer utilities {
  .muted {
    color: var(--color-ink-subtle);
    font-size: 12px;
  }

  .link {
    color: var(--color-accent);
    text-decoration: none;
  }

  .link:hover {
    text-decoration: underline;
  }
}

/* ============================= Overrides ========================== */
@layer overrides {
  /* @deprecated: unused selectors retained for future audits (none) */
}
